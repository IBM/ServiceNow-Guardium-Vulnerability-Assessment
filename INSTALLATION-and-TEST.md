<details open="open">
  <summary><b>Table of contents</b></summary>

  - [Requirements](#requirements)
  - [Installation Instructions](#installation-instructions)
  - [SSL Certificates](#ssl-certificates)
  - [Testing](#testing)
  - [Licensing](#licensing)
  - [Contributing](CONTRIBUTING.md)
  - [Contact us](issues)

</details>

<hr/>

# IBM Guardium Vulnerability Assessment app in ServiceNow

## Requirements

### IBM Guardium
- IBM Guardium 11.4 + Patch 441 (available in August 2022) or IBM Guardium 11.5 Beta
- IBM Guardium user with Guardium "vulnerability-access" role (or Guardium "admin" role) 
- Add "vulnerability-access" role to all existing Guardium data sources to allow the ServiceNow plug-in access to update and delete existing data sources

### ServiceNow
- ServiceNow Rome (or better) release
- [ServiceNow Vulnerability Response](https://www.servicenow.com/products/vulnerability-response.html) module
- [ServiceNow Configuration Compliance](https://www.servicenow.com/content/dam/servicenow-assets/public/en-us/doc-type/resource-center/data-sheet/ds-security-operations.pdf) module (optional but highly recommended)

## Installation Instructions

### Create a user with "MID Server" role

- When you install the MID server, you will need a ServiceNow user and password
- After creating the user, add "MID Server" role to the user
<div style="padding-left: 2em;padding-top: 1em;">

![](images/mid-server-role.png)
</div>

### Install MID server (to be able to communicate with Guardium CM)

- Install and configure MID server to allow communication from ServiceNow to the Guardium Central Manager within your firewall

- Follow [ServiceNow instructions](https://docs.servicenow.com/bundle/sandiego-servicenow-platform/page/product/mid-server/concept/mid-server-landing.html) to add a new MID server entry in ServiceNow


### Install Vulnerability Response Module

* ServiceNow Products > Security Operations > Vulnerability Response
* Manage
* Install/Update All (4)

### Install Configuration Compliance Module

* ServiceNow Products > Security Operations > Configuration Compliance
* Manage
* Install/Update All (4)

<div style="padding-left: 2em;padding-top: 1em;">

![](images/security-operations-store.png)
</div>

### Install latest ServiceNow **Update Set** onto your developer instance

- Download the latest [XML Update Set in GitHub](https://github.com/IBM/ServiceNow-Guardium-Vulnerability-Assessment/blob/main/Update-Sets)
- Login to your ServiceNow developer instance
- Navigate to System Update Sets > Retrieved Update Sets > Import Update Set from XML
- Browse > Select the "Update Set" XML file > Upload
- Click on the "IBM Guardium" label
- Click "Preview Update Set"
- Click "Commit Update Set"
- Click "Close"
- Verify that the IBM Guardium menu has been added to the Navigation Menu by typing "Guardium" in the navigation menu

## SSL Certificates

### Create Self-Signed Certificate

- Here is a bash script that can generate a certificate and private key needed by IBM Guardium
- Run like this: `./gen-cert.sh my.fully.qualified.host.com`

```
#!/bin/bash

FQDN=$(echo ${1} | xargs)
HOSTNAME=$(echo ${FQDN} | cut -d"." -f1)
if [ "$HOSTNAME" == "" ] || [ "$HOSTNAME" == "$FQDN" ]; then
    echo "ERROR: must provide full host name like: my.fully.qualified.host.com"
    exit 1
fi

echo "Generating certificate for: ${FQDN}"
openssl req -batch -newkey rsa:2048 -nodes -subj "/C=US/ST=MA/L=LOWELL/ORG=IBM/OU=Guardium/CN=${FQDN}/emailAddress=${HOSTNAME}@mailinator.com" -keyout ${HOSTNAME}.key -out ${HOSTNAME}.csr
openssl x509 -signkey ${HOSTNAME}.key -in ${HOSTNAME}.csr -req -days 365 -out ${HOSTNAME}.crt

echo " "
cat ${HOSTNAME}.crt

echo " "
cat ${HOSTNAME}.key
```

### Replace Guardium Central Manager Certificate

- Copy and paste information echoed by the above script into this Guardium CLI command
```
store certificate gui console
```
- After completing, Guardium GUI will restart to use the new SSL certificate

### Trust Guardium Central Manager

- You must add the new SSL certificate to the MID server Java keystore to build trust
- SSH onto the MID server and perform these commands, again using `my.fully.qualified.host.com` as an example:

```
cd /servicenow/ibm_resilient_mid_server/agent

echo -n | openssl s_client -connect my.fully.qualified.host.com:8443 | openssl x509 > ./my-central-manager.cert

keytool -import -alias "my-central-manager" -file "./my-central-manager.cert" -keystore ./jre/lib/security/cacerts
```

## Testing

- Add "vulnerability-access" role to all existing Guardium data sources to allow the ServiceNow plug-in access to update and delete existing data sources
- Create a Guardium user that ServiceNow can use to communicate with Guardium over REST-API.  The Guardium user must have at least role: `vulnerability-assess`
- Create two users.  One with `x_ibmrt_gdpva.admin` role and one with `x_ibmrt_gdpva.user` role. These roles will have access to certain parts of the ServiceNow Guardium application.
- As `x_ibmrt_gdpva.admin`, verify you can add a Guardium central manager or stand-alone machine
- Verify that Guardium data sources, data source groups, vulnerability tests, assessment tests, test results, and test exceptions are all automatically imported from Guardium into ServiceNow (may take a few hours)
- As `x_ibmrt_gdpva.user` or `x_ibmrt_gdpva.admin`, verify that an assessment test can be started from ServiceNow UI
- As `x_ibmrt_gdpva.admin`, verify database instances can be exported from ServiceNow to Guardium
- Verify any change in ServiceNow to data source groups and test exceptions are immediately synchronized from ServiceNow to Guardium

## Licensing

[Project License](LICENSE)

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
