<details open="open">
  <summary><b>Table of contents</b></summary>

  - [Introduction](/IBM/ServiceNow-Guardium-Vulnerability-Assessment/DESIGN-DOC.md#introduction)
  - [Requirements](#requirements)
  - [Installation Instructions](#installation-instructions)
  - [How to Integrate GITHUB Repository with ServiceNow Instance](#how-to-integrate-github-repository-with-servicenow-instance)
  - [Publish "Update Set" for QA Testing](#publish-update-set-for-qa-testing)
  - [Publish ServiceNow App to ServiceNow Store](#publish-servicenow-app-to-servicenow-store)
  - [Licensing](#licensing)
  - [Contributing](/IBM/ServiceNow-Guardium-Vulnerability-Assessment/CONTRIBUTING.md)
  - [Open Issues](/IBM/ServiceNow-Guardium-Vulnerability-Assessment/issues)
  - [Support](/IBM/ServiceNow-Guardium-Vulnerability-Assessment/issues/new/choose)

</details>

<hr/>

# ServiceNow Integration

## Requirements

### IBM Guardium
- IBM Guardium 11.4 + Patch 441 (available in August 2022) (Patch 460 will add CVSS Attack Vector) or IBM Guardium 11.5 (with latest patch to add CVSS Attack Vector)
- IBM Guardium user with Guardium `vulnerability-access` role (or Guardium `admin` role) 
- (Optional) Add `vulnerability-access` role to all existing Guardium data sources to permit the ServiceNow plug-in the ability to update and delete existing data sources which result from changes to ServiceNow CMDB

### ServiceNow
- Tested on ServiceNow releases: Rome, San Diego, Tokyo 
- [ServiceNow Vulnerability Response](https://www.servicenow.com/products/vulnerability-response.html) module
- [ServiceNow Configuration Compliance](https://www.servicenow.com/content/dam/servicenow-assets/public/en-us/doc-type/resource-center/data-sheet/ds-security-operations.pdf) module (optional but highly recommended)

## Installation Instructions

### Install Vulnerability Response Module

* ServiceNow Products > Security Operations > Vulnerability Response
* Manage
* Install/Update All (4)

### Install Configuration Compliance Module

* ServiceNow Products > Security Operations > Configuration Compliance
* Manage
* Install/Update All (4)

<div style="padding-left: 2em;padding-top: 1em;">

![](images/security-operations-store.png)
</div>

## How to Integrate GITHUB Repository with ServiceNow Instance

Pre-req: Personal access token for Github. If you don't have one, follow the instructions https://docs.github.com/en/free-pro-team@latest/github/authenticating-to-github/creating-a-personal-access-token to create one (no elevated permissions needed for the token).

1. Obtain a developer instance for ServiceNow following the instructions from https://developer.servicenow.com/dev.do#!/guides/paris/now-platform/pdi-guide/obtaining-a-pdi (this requires a ServiceNow account which can be created as part of the steps - just sign up for a new account). Note: development instances go into hibernation when not used and are decommissioned if not used for 10 days.
1. Log on to the development instance.
1. Search for `Credentials`.
![Credentials](images/credentials1.png)
1. Select `Credentials` under `Connections & Credentials`.
![Credentials](./images/credentials2.png)
1. Select `Basic Authentication`.
![Credentials](images/credentials3.png)
1. Enter any name
2. Provide your login email address for Github
3. Password is your <a href="https://github.com/settings/tokens">personal access token</a>. 
2. Click `Submit`.
![Credentials](images/credentials4.png)
1. In the Search field, type in `Studio`. Select `Studio` under `System Applications`. This will open the Application Studio in a new tab.
![Studio](images/studio1.png)
1. In the `Select Application` dialog, click `Import from Source Control`.
![Studio](images/studio2.png)
1. Enter `https://github.com/IBM/ServiceNow-Guardium-Vulnerability-Assessment.git` as repository
2. Don't use the `main` branch. Use another branch so you can create a Pull Request to merge to `main`
3. In the `Credential` drop-down, select the entry with the credentials that were created in the previous steps.
![Studio](images/studio3.png)
1. Click `Import` to import the source code.

## Publish Update Set for QA Testing

- Navigate to All > System Applications > **My Company's Applications**
- Click the **In Development** tab
- Open the application record, for example, **IBM Guardium Data Protection**

<div style="padding-left: 2em;padding-top: 1em;">

![](images/deploy-updateset-01.png)
</div>

- Click the **Publish to Update Set** related link

<div style="padding-left: 2em;padding-top: 1em;">

![](images/deploy-updateset-02.png)
</div>

- Fill in version information
- Click **Publish**
- Go to **Local Update Sets**
- Open the record
- Click **Export to XML**

<div style="padding-left: 2em;padding-top: 1em;">

![](images/deploy-updateset-03.png)
</div>

- Download file locally
- Rename to something more relevant like: `ServiceNow-Guardium-App-Beta-15.xml`
- Upload xml file to the [XML Update Set in GitHub](https://github.com/IBM/ServiceNow-Guardium-Vulnerability-Assessment/blob/main/Update-Sets)


## Publish ServiceNow App to ServiceNow Store
Link to app in app store: https://store.servicenow.com/sn_appstore_store.do#!/store/application/632a6d81db102010253148703996197e/1.0.0  


### Pre-requisites: 
1. Need access to vendor instance https://venXXXXX.service-now.com/. Can only upload apps to the store from vendor instance (function is disabled from dev instances).  
1. Need credentials for HI portal: https://hi.service-now.com/. Required to access TPP portal for published apps: https://tpp.servicenow.com/sn_appstore_store.do#!/tpp/program  


### Reference:  
**Technology Partner Technology Resources:** https://community.servicenow.com/community?id=community_blog&sys_id=546e2eaddbd0dbc01dcaf3231f9619ee&view_source=publisherportal  
**Publish portal:** https://tpp.servicenow.com/sn_appstore_store.do#!/tpp/program


### Steps:  
1. Import or edit the app similar into the vendor instance, similar to steps explained in section 1.  
1. After making the required changes and testing the changes locally, go to File | Publish
![Publish](images/publishFile.png)
1. In the dialog, select "ServiceNow Store", set a new version (Note that this is just the development version, it won't change the app version. But every publish needs to be a different development version.). At the bottom, fill in your HI credentials.
![PublishDialog](images/publishDialog.png)
1. Go to TPP publish page: https://tpp.servicenow.com/sn_appstore_store.do#!/tpp/program and log on with HI credentials:
![HILogin](images/hiLogin.png)
![HIPortal](images/hiPortal.png)
The HI publish portal gives accesss to all apps that are published from the vendor instance.
1. Go to the Certify tab and filter by Published stated. This will show the IBM app published:
![HIPortalWAIOpsPublished](images/hiPortalWAIOpsPublished.png)
1. When a new version is being published, the app will also show up in the In-Process state.  
The publish process contained two separate review processes:  
**App review:** Review of app code, including demo of the functionality  
**Listing review:** Review of listing of app in app store. You can work with OM to fill out this information.  

## Licensing

[Project License](/IBM/ServiceNow-Guardium-Vulnerability-Assessment/LICENSE)

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
